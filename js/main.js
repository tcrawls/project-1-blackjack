var cards = [
    {
        points: 2,
        rank: "two",
        suit: "clubs",
        cardFront: "images/card-images/2C.png",
        cardBack: "images/card-images/blue_back.png"
    },
    {
        points: 3,
        rank: "three",
        suit: "clubs",
        cardFront: "images/card-images/3C.png",
        cardBack: "images/card-images/blue_back.png"
    },
    {
        points: 4,
        rank: "four",
        suit: "clubs",
        cardFront: "images/card-images/4C.png",
        cardBack: "images/card-images/blue_back.png"
    },
    {
        points: 5,
        rank: "five",
        suit: "clubs",
        cardFront: "images/card-images/5C.png",
        cardBack: "images/card-images/blue_back.png"
    },
    {
        points: 6,
        rank: "six",
        suit: "clubs",
        cardFront: "images/card-images/6C.png",
        cardBack: "images/card-images/blue_back.png"
    },
    {
        points: 7,
        rank: "seven",
        suit: "clubs",
        cardFront: "images/card-images/7C.png",
        cardBack: "images/card-images/blue_back.png"
    },
    {
        points: 8,
        rank: "eight",
        suit: "clubs",
        cardFront: "images/card-images/8C.png",
        cardBack: "images/card-images/blue_back.png"
    },
    {
        points: 9,
        rank: "nine",
        suit: "clubs",
        cardFront: "images/card-images/9C.png",
        cardBack: "images/card-images/blue_back.png"
    },
    {
        points: 10,
        rank: "ten",
        suit: "clubs",
        cardFront: "images/card-images/10C.png",
        cardBack: "images/card-images/blue_back.png"
    },
    {
        points: 10,
        rank: "jack",
        suit: "clubs",
        cardFront: "images/card-images/JC.png",
        cardBack: "images/card-images/blue_back.png"
    },
    {
        points: 10,
        rank: "queen",
        suit: "clubs",
        cardFront: "images/card-images/QC.png",
        cardBack: "images/card-images/blue_back.png"
    },
    {
        points: 10,
        rank: "king",
        suit: "clubs",
        cardFront: "images/card-images/KC.png",
        cardBack: "images/card-images/blue_back.png"
    },
    {
        points: 11,
        rank: "ace",
        suit: "clubs",
        cardFront: "images/card-images/AC.png",
        cardBack: "images/card-images/blue_back.png"
    },
    {
        points: 2,
        rank: "two",
        suit: "hearts",
        cardFront: "images/card-images/2H.png",
        cardBack: "images/card-images/blue_back.png"
    },
    {
        points: 3,
        rank: "three",
        suit: "hearts",
        cardFront: "images/card-images/3H.png",
        cardBack: "images/card-images/blue_back.png"
    },
    {
        points: 4,
        rank: "four",
        suit: "hearts",
        cardFront: "images/card-images/4H.png",
        cardBack: "images/card-images/blue_back.png"
    },
    {
        points: 5,
        rank: "five",
        suit: "hearts",
        cardFront: "images/card-images/5H.png",
        cardBack: "images/card-images/blue_back.png"
    },
    {
        points: 6,
        rank: "six",
        suit: "hearts",
        cardFront: "images/card-images/6H.png",
        cardBack: "images/card-images/blue_back.png"
    },
    {
        points: 7,
        rank: "seven",
        suit: "hearts",
        cardFront: "images/card-images/7H.png",
        cardBack: "images/card-images/blue_back.png"
    },
    {
        points: 8,
        rank: "eight",
        suit: "hearts",
        cardFront: "images/card-images/8H.png",
        cardBack: "images/card-images/blue_back.png"
    },
    {
        points: 9,
        rank: "nine",
        suit: "hearts",
        cardFront: "images/card-images/9H.png",
        cardBack: "images/card-images/blue_back.png"
    },
    {
        points: 10,
        rank: "ten",
        suit: "hearts",
        cardFront: "images/card-images/10H.png",
        cardBack: "images/card-images/blue_back.png"
    },
    {
        points: 10,
        rank: "jack",
        suit: "hearts",
        cardFront: "images/card-images/JH.png",
        cardBack: "images/card-images/blue_back.png"
    },
    {
        points: 10,
        rank: "queen",
        suit: "hearts",
        cardFront: "images/card-images/QH.png",
        cardBack: "images/card-images/blue_back.png"
    },
    {
        points: 10,
        rank: "king",
        suit: "hearts",
        cardFront: "images/card-images/KH.png",
        cardBack: "images/card-images/blue_back.png"
    },
    {
        points: 11,
        rank: "ace",
        suit: "hearts",
        cardFront: "images/card-images/AH.png",
        cardBack: "images/card-images/blue_back.png"
    },
    {
        points: 2,
        rank: "two",
        suit: "diamonds",
        cardFront: "images/card-images/2D.png",
        cardBack: "images/card-images/blue_back.png"
    },
    {
        points: 3,
        rank: "three",
        suit: "diamonds",
        cardFront: "images/card-images/3D.png",
        cardBack: "images/card-images/blue_back.png"
    },
    {
        points: 4,
        rank: "four",
        suit: "diamonds",
        cardFront: "images/card-images/4D.png",
        cardBack: "images/card-images/blue_back.png"
    },
    {
        points: 5,
        rank: "five",
        suit: "diamonds",
        cardFront: "images/card-images/5D.png",
        cardBack: "images/card-images/blue_back.png"
    },
    {
        points: 6,
        rank: "six",
        suit: "diamonds",
        cardFront: "images/card-images/6D.png",
        cardBack: "images/card-images/blue_back.png"
    },
    {
        points: 7,
        rank: "seven",
        suit: "diamonds",
        cardFront: "images/card-images/7D.png",
        cardBack: "images/card-images/blue_back.png"
    },
    {
        points: 8,
        rank: "eight",
        suit: "diamonds",
        cardFront: "images/card-images/8D.png",
        cardBack: "images/card-images/blue_back.png"
    },
    {
        points: 9,
        rank: "nine",
        suit: "diamonds",
        cardFront: "images/card-images/9D.png",
        cardBack: "images/card-images/blue_back.png"
    },
    {
        points: 10,
        rank: "ten",
        suit: "diamonds",
        cardFront: "images/card-images/10D.png",
        cardBack: "images/card-images/blue_back.png"
    },
    {
        points: 10,
        rank: "jack",
        suit: "diamonds",
        cardFront: "images/card-images/JD.png",
        cardBack: "images/card-images/blue_back.png"
    },
    {
        points: 10,
        rank: "queen",
        suit: "diamonds",
        cardFront: "images/card-images/QD.png",
        cardBack: "images/card-images/blue_back.png"
    },
    {
        points: 10,
        rank: "king",
        suit: "diamonds",
        cardFront: "images/card-images/KD.png",
        cardBack: "images/card-images/blue_back.png"
    },
    {
        points: 11,
        rank: "ace",
        suit: "diamonds",
        cardFront: "images/card-images/AD.png",
        cardBack: "images/card-images/blue_back.png"
    },
    {
        points: 2,
        rank: "two",
        suit: "spades",
        cardFront: "images/card-images/2S.png",
        cardBack: "images/card-images/blue_back.png"
    },
    {
        points: 3,
        rank: "three",
        suit: "spades",
        cardFront: "images/card-images/3S.png",
        cardBack: "images/card-images/blue_back.png"
    },
    {
        points: 4,
        rank: "four",
        suit: "spades",
        cardFront: "images/card-images/4S.png",
        cardBack: "images/card-images/blue_back.png"
    },
    {
        points: 5,
        rank: "five",
        suit: "spades",
        cardFront: "images/card-images/5S.png",
        cardBack: "images/card-images/blue_back.png"
    },
    {
        points: 6,
        rank: "six",
        suit: "spades",
        cardFront: "images/card-images/6S.png",
        cardBack: "images/card-images/blue_back.png"
    },
    {
        points: 7,
        rank: "seven",
        suit: "spades",
        cardFront: "images/card-images/7S.png",
        cardBack: "images/card-images/blue_back.png"
    },
    {
        points: 8,
        rank: "eight",
        suit: "spades",
        cardFront: "images/card-images/8S.png",
        cardBack: "images/card-images/blue_back.png"
    },
    {
        points: 9,
        rank: "nine",
        suit: "spades",
        cardFront: "images/card-images/9S.png",
        cardBack: "images/card-images/blue_back.png"
    },
    {
        points: 10,
        rank: "ten",
        suit: "spades",
        cardFront: "images/card-images/10S.png",
        cardBack: "images/card-images/blue_back.png"
    },
    {
        points: 10,
        rank: "jack",
        suit: "spades",
        cardFront: "images/card-images/JS.png",
        cardBack: "images/card-images/blue_back.png"
    },
    {
        points: 10,
        rank: "queen",
        suit: "spades",
        cardFront: "images/card-images/QS.png",
        cardBack: "images/card-images/blue_back.png"
    },
    {
        points: 10,
        rank: "king",
        suit: "spades",
        cardFront: "images/card-images/KS.png",
        cardBack: "images/card-images/blue_back.png"
    },
    {
        points: 11,
        rank: "ace",
        suit: "spades",
        cardFront: "images/card-images/AS.png",
        cardBack: "images/card-images/blue_back.png"
    }
    ]

var cardsInDeck = []
var playerCards = []
var dealerCards = []
var mysteryCard = ''
var dealerScore = 0
var playerScore = 0
var overallScore = ''

// SHUFFLE CARDS FUNCTION:
// Source: https://stackoverflow.com/questions/2450954/how-to-randomize-shuffle-a-javascript-array
function shuffle(array) {
    var currentIndex = array.length, temporaryValue, randomIndex

    // While there remain elements to shuffle...
    while (0 !== currentIndex) {
      
        // Pick a remaining element...
        randomIndex = Math.floor(Math.random() * currentIndex)
        currentIndex -= 1
      
        // And swap it with the current element.
        temporaryValue = array[currentIndex]
        array[currentIndex] = array[randomIndex]
        array[randomIndex] = temporaryValue
    }
    // Store the shuffled deck/array in cardsInDeck array
    cardsInDeck = array
    return cardsInDeck
}

// CALCULATE PLAYER'S SCORE:
function calculatePlayerScore() {

    // Reset playerScore to 0
    playerScore = 0

    // Calculate new playerScore by looping through the playerCards array, summing all the point values, and assigning that sum to playerScore
    for (i = 0; i < playerCards.length; i++) {
        playerScore += playerCards[i].points
    }
}

// CALCULATE DEALER'S SCORE:
function calculateDealerScore() {

    // Reset dealerScore to 0
    dealerScore = 0

    // Calculate new dealerScore by looping through the dealerCards array, summing all the point values, and assigning that sum to dealerScore
    for (i = 0; i < dealerCards.length; i++) {
        dealerScore += dealerCards[i].points
    }
}

// DEAL CARD TO PLAYER: 
function dealPlayer() {

    // Pop from cardsInDeck array and push to playerCards array
    playerCards.push(cardsInDeck.pop())
    let newCard = playerCards[playerCards.length - 1]

    // Create a new <img> element that displays the front of newCard 
    let newCardElement = document.createElement('img')
    newCardElement.setAttribute('src', newCard.cardFront)
    document.getElementById('player-hand').appendChild(newCardElement)
    calculatePlayerScore()

    // If playerScore exceeds 21, check for any Aces in playerCards array. If one is found, modify its points to 1 (i.e. count Ace as 1 point instead of 11).
    if (playerScore > 21) {
        for (i = 0; i < playerCards.length; i++) {
            if (playerCards[i].rank === "ace") {
                playerCards[i].points = 1
            }
        }

        // After modifying Ace values, recalculate playerScore
        calculatePlayerScore()
    }

    // Display updated playerScore on screen and check for bust
    document.getElementById('player-points').innerHTML = playerScore
    if (playerScore > 21) {
        console.log('You busted!')
        document.getElementById('message-text').innerHTML = "You busted!<br>Click DEAL to play again."
        overallScore -= 1
        document.getElementById('overall-points').innerHTML = overallScore
    } 
    
    // Stand if score is exactly 21
    else if (playerScore === 21) {
        stand()
    }
    console.log(playerScore)
}

// DEAL CARD TO DEALER:
function dealDealer() {

    // Pop from cardsInDeck array and push to dealerCards array
    dealerCards.push(cardsInDeck.pop())
    let newCard = dealerCards[dealerCards.length - 1]

    // Create a new <img> element that displays the front of newCard 
    let newCardElement = document.createElement('img')
    newCardElement.setAttribute('src', newCard.cardFront)
    document.getElementById('dealer-hand').appendChild(newCardElement)
    calculateDealerScore()

    // If dealerScore exceeds 21, check for any Aces in dealerCards array. If you find one, modify its points to 1 (i.e. count Ace as 1 point instead of 11).
    if (dealerScore > 21) {
        for (i = 0; i < dealerCards.length; i++) {
            if (dealerCards[i].rank === "ace") {
                dealerCards[i].points = 1
            }
        }

        // After modifying Ace values, recalculate dealerScore
        calculateDealerScore()
    }
    document.getElementById('dealer-points').innerHTML = dealerScore
    console.log(dealerScore)
}

// DEAL MYSTERY CARD:
function dealMysteryCard() {

    // Pop from cardsInDeck array and assign to mysteryCard
    mysteryCard = cardsInDeck.pop()

    // Create new <img> element and display cardBack on screen
    let mysteryCardElement = document.createElement('img')
    mysteryCardElement.setAttribute('src', mysteryCard.cardBack)
    document.getElementById('dealer-hand').appendChild(mysteryCardElement)
    console.log("Dealt mystery card")
}

// STAND:
function stand() {

    // Flip over mystery card, push it to front of dealerCards array and display cardFront
    dealerCards.unshift(mysteryCard)
    let mysteryCardElement = document.getElementById('dealer-hand').firstElementChild
    mysteryCardElement.setAttribute('src', mysteryCard.cardFront)

    // Recalculate dealer's score to include points from mystery card
    calculateDealerScore()
    document.getElementById('dealer-points').innerHTML = dealerScore

    // As long as dealer's score < player's score, dealer keeps drawing cards
    while (dealerScore < playerScore) {
        dealDealer()
    } 
    compareScores()
}

// COMPARE SCORES: 
function compareScores() {

    // Compare Player's score vs. Dealer's score and display appropriate message
    if (dealerScore > 21 && playerScore > 21) {
        console.log ("It's a push!")
        document.getElementById('message-text').innerHTML = "It's a push!<br>Click DEAL to play again."
    } else if (dealerScore > 21 && playerScore <= 21) {
        console.log("Dealer busted! You win!")
        document.getElementById('message-text').innerHTML = "Dealer busted! You win!<br>Click DEAL to play again."
        overallScore += 1
        document.getElementById('overall-points').innerHTML = overallScore
    } else if (playerScore > 21 && dealerScore <= 21) {
        console.log("You busted!")
        document.getElementById('message-text').innerHTML = "You busted!<br>Click DEAL to play again."
        overallScore -= 1
        document.getElementById('overall-points').innerHTML = overallScore
    } else if (playerScore === dealerScore) {
        console.log("It's a push!")
        document.getElementById('message-text').innerHTML = "It's a push!<br>Click DEAL to play again."
    } else if (playerScore > dealerScore) {
        console.log("Congratulations, you win!")
        document.getElementById('message-text').innerHTML = "Congratulations, you win!<br>Click DEAL to play again."
        overallScore += 1
        document.getElementById('overall-points').innerHTML = overallScore
    } else if (dealerScore > playerScore) {
        console.log("You lost! Better luck next time!")
        document.getElementById('message-text').innerHTML = "You lose!<br>Click DEAL to play again."
        overallScore -= 1
        document.getElementById('overall-points').innerHTML = overallScore
    }
}

// CLEAR TABLE:
function clearTable() {

    // Empty all image elements from dealer and player hands
    $('.hand').empty()

    // Clear array and variable values and update message
    cardsInDeck = []
    playerCards = []
    dealerCards = []
    dealerScore = 0
    playerScore = 0
    mysteryCard = ''
    document.getElementById('message-text').innerHTML = "Let's play!<br>Choose STAND or HIT"
}

// DEAL CARDS: 
function initiateGame() {

    // Clear table, shuffle deck and deal the intial cards to start a game:
    clearTable()
    shuffle(cards)
    dealPlayer()
    dealMysteryCard()
    dealPlayer()
    dealDealer()

    // If player hits 21 on initial deal, automatically wins that hand
    if (playerScore === 21) {
        document.getElementById('message-text').innerHTML = "Black Jack! You win!<br>Click DEAL to play again"
        overallScore += 1
        document.getElementById('overall-points').innerHTML = overallScore
        console.log("Black Jack! You win!<br>Click DEAL to play again")
        return
    }
}

document.getElementById('dealer-points').innerHTML = 0
document.getElementById('player-points').innerHTML = 0
document.getElementById('overall-points').innerHTML = 0

document.getElementById('deal').addEventListener('click', initiateGame)
document.getElementById('hit').addEventListener('click', dealPlayer)
document.getElementById('stand').addEventListener('click', stand)




